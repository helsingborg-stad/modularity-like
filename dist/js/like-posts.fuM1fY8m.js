var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});const _LikedCounter=class _LikedCounter{constructor(likeStorage,counterIcons){this.likeStorage=likeStorage,this.counterElements=this.addCounterToIcon(counterIcons),this.updateCounter()}addCounterToIcon(counterIcons){return counterIcons.map(counterIcon=>(counterIcon.innerHTML+=this.getLikeIconMarkup(),counterIcon.querySelector("[data-js-like-counter]")))}updateCounter(){const likedPostsLength=Object.keys(this.likeStorage.get()).length;this.counterElements.forEach(counterElement=>{counterElement&&(counterElement.innerHTML=likedPostsLength.toString()),likedPostsLength===0?counterElement?.classList.add("u-display--none"):counterElement?.classList.remove("u-display--none")})}getLikeIconMarkup(){return'<span class="u-display--none like-counter" data-js-like-counter></span>'}};__name(_LikedCounter,"LikedCounter");let LikedCounter=_LikedCounter;function initializeLikedCounter(likeStorage){const counterIcons=document.querySelectorAll("[data-js-like-icon-counter]");if(counterIcons.length===0)return;const likeCounterInstance=new LikedCounter(likeStorage,[...counterIcons]);window.addEventListener("likedPostsLengthUpdated",e=>{likeCounterInstance.updateCounter()})}__name(initializeLikedCounter,"initializeLikedCounter");const _Shared=class _Shared{constructor(renderContainer,urlParams,title,excerpt){this.renderContainer=renderContainer,this.urlParams=urlParams,this.title=title,this.excerpt=excerpt,this.displayNoneClass="u-display--none",this.nameParamKey="liked-name",this.excerptParamKey="liked-excerpt",this.addSharedData()}addSharedData(){let listName=this.urlParams.get(this.nameParamKey),listExcerpt=this.urlParams.get(this.excerptParamKey);this.title&&listName&&this.setSharedValue(this.title,listName),this.excerpt&&listExcerpt&&this.setSharedValue(this.excerpt,listExcerpt)}setSharedValue(element,value){element.textContent=this.sanitizeUrlParams(value),element.classList.remove(this.displayNoneClass)}sanitizeUrlParams(encodedString){let string=atob(encodedString);return string=string.replace(/(<([^>]+)>)/gi,""),string}};__name(_Shared,"Shared");let Shared=_Shared;const _Share=class _Share{constructor(likeStorage,postTypesToShow,postAppearance,likedPostsStructurer,likedPostsApiUrlBuilder,shareButton,urlField,nameField,excerptField){this.likeStorage=likeStorage,this.postTypesToShow=postTypesToShow,this.postAppearance=postAppearance,this.likedPostsStructurer=likedPostsStructurer,this.likedPostsApiUrlBuilder=likedPostsApiUrlBuilder,this.shareButton=shareButton,this.urlField=urlField,this.nameField=nameField,this.excerptField=excerptField,this.sharedParamKey="liked-posts",this.displayNoneClass="u-display--none",new URLSearchParams(window.location.search).get(this.sharedParamKey)||this.renderShareLink()}renderShareLink(){const url=window.location.href.split("?")[0],encodedLikedPostsParam=this.generateEncodedLikedPostsParam();if(!encodedLikedPostsParam)return;const shareLink=`${url}${encodedLikedPostsParam}`;this.urlField.value=shareLink,this.nameField.addEventListener("input",this.updateShareLink.bind(this,this.urlField,this.nameField,this.excerptField)),this.excerptField.addEventListener("input",this.updateShareLink.bind(this,this.urlField,this.nameField,this.excerptField)),this.shareButton.classList.remove(this.displayNoneClass)}generateEncodedLikedPostsParam(){const likedPosts2=this.likeStorage.get();if(Object.keys(likedPosts2).length==0)return!1;const apiUrls=this.likedPostsApiUrlBuilder.build(likedPosts2,this.postAppearance,this.postTypesToShow);return"?liked-posts="+btoa(JSON.stringify(apiUrls))}updateShareLink(urlField,nameField,excerptField){const newName=btoa(nameField.value),newExcerpt=btoa(excerptField.value),url=new URL(urlField.value);url&&(url.searchParams.set("liked-name",newName),url.searchParams.set("liked-excerpt",newExcerpt),newName||url.searchParams.delete("liked-name"),newExcerpt||url.searchParams.delete("liked-excerpt")),urlField.value=url.href}};__name(_Share,"Share");let Share=_Share;const _LikeModule=class _LikeModule{constructor(wpApiSettings2,likeStorage,sharedPosts,likedPostsStructurer,likedPostsApiUrlBuilder,postTypesToShow,postAppearance,renderContainer,noPostsNotice,preLoaders){if(this.wpApiSettings=wpApiSettings2,this.likeStorage=likeStorage,this.sharedPosts=sharedPosts,this.likedPostsStructurer=likedPostsStructurer,this.likedPostsApiUrlBuilder=likedPostsApiUrlBuilder,this.postTypesToShow=postTypesToShow,this.postAppearance=postAppearance,this.renderContainer=renderContainer,this.noPostsNotice=noPostsNotice,this.preLoaders=preLoaders,this.displayNoneClass="u-display--none",this.likedPosts=this.likeStorage.get(),this.sharedPosts){const decodedSharedPosts=atob(this.sharedPosts),apiUrl=JSON.parse(decodedSharedPosts);typeof apiUrl=="string"&&apiUrl.length>0?this.fetchPosts(apiUrl):(console.error("Invalid shared posts data:",this.sharedPosts),this.noPostsFound())}else this.handleLikedPosts()}handleLikedPosts(){if(Object.keys(this.likedPosts).length<=0){this.noPostsFound();return}const apiUrl=this.likedPostsApiUrlBuilder.build(this.likedPosts,this.postAppearance,this.postTypesToShow);this.fetchPosts(apiUrl)}fetchPosts(apiUrl){fetch(apiUrl,{credentials:"include",headers:{"Content-Type":"application/json","X-WP-NONCE":this.wpApiSettings?.nonce??""}}).then(response=>{if(!response.ok)throw new Error("Failed to fetch post");return response.json()}).then(postsMarkup=>{this.handleFetched(postsMarkup)}).catch(error=>{console.error("Fetch error:",error),this.noPostsFound()})}handleFetched(posts){if(!posts||typeof posts!="string"){this.noPostsFound();return}this.removePreloaders(),this.renderContainer.innerHTML=posts}removePreloaders(){this.preLoaders.forEach(preloader=>{preloader.remove()})}noPostsFound(){this.noPostsNotice.classList.remove(this.displayNoneClass),this.removePreloaders()}};__name(_LikeModule,"LikeModule");let LikeModule=_LikeModule;const _UserStorage=class _UserStorage{constructor(wpApiSettings2,userId,likedPostsMeta){this.wpApiSettings=wpApiSettings2,this.userId=userId,this.likedPosts={},this.userEndpoint="",this.userEndpoint=`${this.wpApiSettings.root}wp/v2/users/${this.userId}`,this.likedPosts=this.sanitizeLikedPostsMeta(likedPostsMeta)}get(){return this.likedPosts}set(postId,postType,blogId){const key=`${blogId}-${postId}`,runtimeLikedPosts=this.get();runtimeLikedPosts[key]?delete runtimeLikedPosts[key]:runtimeLikedPosts[key]={postType,blogId,postId,likedAt:Date.now(),website:this.wpApiSettings.root},fetch(this.userEndpoint,{method:"PATCH",headers:{"Content-Type":"application/json","X-WP-NONCE":wpApiSettings?.nonce??""},body:JSON.stringify({meta:{likedPosts:runtimeLikedPosts}})}).then(response=>{if(!response.ok)throw new Error("Failed to update user data");return response.json()}).catch(error=>{console.error("Error:",error)})}sanitizeLikedPostsMeta(likedPostsMeta){return!likedPostsMeta||typeof likedPostsMeta!="object"?{}:Object.fromEntries(Object.entries(likedPostsMeta).filter(([_,value])=>value&&typeof value=="object"&&"postId"in value&&"blogId"in value&&"postType"in value&&"likedAt"in value))}};__name(_UserStorage,"UserStorage");let UserStorage=_UserStorage;const _LocalStorage=class _LocalStorage{constructor(wpApiSettings2,currentBlogId){this.wpApiSettings=wpApiSettings2,this.currentBlogId=currentBlogId,this.localeStorageKey="liked-posts-v2",this.likedPosts=this.sanitizeLikedPosts(JSON.parse(localStorage.getItem(this.localeStorageKey)||"{}"))}get(){return this.likedPosts}set(postId,postType,blogId){let likedPostsIds=this.get();const key=`${blogId}-${postId}`;likedPostsIds[key]?delete likedPostsIds[key]:likedPostsIds[key]={postType,blogId,postId,likedAt:Date.now(),website:this.wpApiSettings.root},localStorage.setItem(this.localeStorageKey,JSON.stringify(likedPostsIds)),this.likedPosts=likedPostsIds}sanitizeLikedPosts(likedPosts2){const localLikedPosts={};for(const id in likedPosts2){if(typeof likedPosts2[id]!="string"){localLikedPosts[id]=likedPosts2[id];continue}const key=`${this.currentBlogId}-${id}`;localLikedPosts[key]={postType:likedPosts2[id],blogId:this.currentBlogId,postId:id,likedAt:Date.now(),website:this.wpApiSettings.root}}return localLikedPosts}};__name(_LocalStorage,"LocalStorage");let LocalStorage=_LocalStorage;const likeIconSelector="[data-like-icon]",likedIconClass="material-symbols--filled",postIdAttribute="data-post-id",postTypeAttribute="data-post-type",blogIdAttribute="data-blog-id",tooltipAttribute="data-tooltip",iconWrapperAttribute="data-js-like-icon-wrapper",_Like=class _Like{constructor(likeStorage,likeInstancesStorage,button,wrapper,postId,postType,tooltipLike,tooltipUnlike,blogId){this.likeStorage=likeStorage,this.likeInstancesStorage=likeInstancesStorage,this.button=button,this.wrapper=wrapper,this.postId=postId,this.postType=postType,this.tooltipLike=tooltipLike,this.tooltipUnlike=tooltipUnlike,this.blogId=blogId,this.key=`${this.blogId}-${this.postId}`,this.hasTooltip=!!(this.wrapper&&(this.tooltipLike||this.tooltipUnlike)),this.updateLikedStatus(),this.setTooltip(),this.setListener()}setListener(){this.button.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.likeStorage.set(this.postId,this.postType,this.blogId),this.toggleLiked(),window.dispatchEvent(this.likedPostsUpdatedEvent())})}setTooltip(){if(!this.hasTooltip)return;this.likeStorage.get()[this.key]?this.tooltipUnlike?this.wrapper.setAttribute(tooltipAttribute,this.tooltipUnlike):this.wrapper.removeAttribute(tooltipAttribute):this.tooltipLike?this.wrapper.setAttribute(tooltipAttribute,this.tooltipLike):this.wrapper.removeAttribute(tooltipAttribute)}toggleLiked(){this.likeInstancesStorage.getInstances(this.key).forEach(instance=>{instance.updateLikedStatus(),instance.setTooltip()})}updateLikedStatus(){this.likeStorage.get()[this.key]?this.button.classList.add(likedIconClass):this.button.classList.remove(likedIconClass)}likedPostsUpdatedEvent(){return new CustomEvent("likedPostsLengthUpdated",{})}};__name(_Like,"Like");let Like=_Like;function initializeLikeButtons(likeStorage,likeInstancesStorage,tooltipLike,tooltipUnlike){const createLikeInstance=__name(button=>{const postId=button.getAttribute(postIdAttribute),postType=button.getAttribute(postTypeAttribute),blogId=button.getAttribute(blogIdAttribute);if(!postId||!postType||!blogId){console.warn("Like button is missing required blogId for likeable post",button);return}const wrapper=button.closest(`[${iconWrapperAttribute}]`);likeInstancesStorage.addInstance(`${blogId}-${postId}`,new Like(likeStorage,likeInstancesStorage,button,wrapper,postId,postType,tooltipLike,tooltipUnlike,blogId))},"createLikeInstance");document.querySelectorAll(likeIconSelector).forEach(button=>{createLikeInstance(button)}),new MutationObserver(mutations=>{mutations.forEach(mutation=>{mutation.type==="childList"&&mutation.addedNodes.length>0&&[...mutation.addedNodes].forEach(node=>{if(node.nodeType===Node.ELEMENT_NODE){const element=node;element.matches(likeIconSelector)&&createLikeInstance(element),element.querySelectorAll(likeIconSelector).forEach(button=>{createLikeInstance(button)})}})})}).observe(document.body,{childList:!0,subtree:!0})}__name(initializeLikeButtons,"initializeLikeButtons");const _LikeInstancesStorage=class _LikeInstancesStorage{constructor(){this.instances={}}getInstances(postId){return this.instances[postId]||[]}addInstance(postId,likeInstance){this.instances[postId]||(this.instances[postId]=[]),this.instances[postId].push(likeInstance)}};__name(_LikeInstancesStorage,"LikeInstancesStorage");let LikeInstancesStorage=_LikeInstancesStorage;const _LikedPostsStructurer=class _LikedPostsStructurer{structure(likedPosts2){const strucuturedLikedPosts={};for(const id in likedPosts2)strucuturedLikedPosts[likedPosts2[id].website]||(strucuturedLikedPosts[likedPosts2[id].website]=[]),strucuturedLikedPosts[likedPosts2[id].website].push(likedPosts2[id]);return strucuturedLikedPosts}};__name(_LikedPostsStructurer,"LikedPostsStructurer");let LikedPostsStructurer=_LikedPostsStructurer;const _LikedPostsApiUrlBuilder=class _LikedPostsApiUrlBuilder{constructor(wpApiSettings2){this.wpApiSettings=wpApiSettings2}build(likedPosts2,appearance,postTypes){let postIds=[];for(const postId in likedPosts2)(!postTypes||postTypes.includes(likedPosts2[postId].postType))&&postIds.push(postId);return`${this.wpApiSettings.root}like/v1/ids=${postIds.join(",")}?html&appearance=${appearance}&cache-bust=${Date.now()}`}};__name(_LikedPostsApiUrlBuilder,"LikedPostsApiUrlBuilder");let LikedPostsApiUrlBuilder=_LikedPostsApiUrlBuilder;document.addEventListener("DOMContentLoaded",()=>{const localWpApiSettings=wpApiSettings,likeStorage=likedPosts&&likedPosts.currentUser&&likedPosts.currentUser!=="0"&&likedPosts.likedPostsMeta&&localWpApiSettings?new UserStorage(localWpApiSettings,likedPosts.currentUser,likedPosts.likedPostsMeta):new LocalStorage(localWpApiSettings,likedPosts.currentBlogId),tooltipLike=likedPosts.tooltipLike,tooltipUnlike=likedPosts.tooltipUnlike;initializeLikedCounter(likeStorage),initializeLikeButtons(likeStorage,new LikeInstancesStorage,tooltipLike,tooltipUnlike),document.querySelectorAll("[data-js-like-posts]").forEach(likePostsContainer=>{const postTypesToShow=JSON.parse(likePostsContainer.getAttribute("data-js-like-posts-post-types")||"[]"),postAppearance=likePostsContainer.getAttribute("data-js-like-posts-appearance")||"collection",renderContainer=likePostsContainer.querySelector("[data-js-render-container]"),noPostsNotice=likePostsContainer.querySelector("[data-js-no-posts-notice]"),preLoaders=likePostsContainer.querySelectorAll("[data-js-like-preloader]"),sharedTitle=likePostsContainer.querySelector("[data-js-liked-posts-share-title]"),sharedExcerpt=likePostsContainer.querySelector("[data-js-liked-posts-share-excerpt]"),shareUrlField=likePostsContainer.querySelector("[data-js-like-share-url]"),shareListField=likePostsContainer.querySelector("[data-js-like-share-name]"),shareExcerptField=likePostsContainer.querySelector("[data-js-like-share-excerpt]"),shareButton=likePostsContainer.querySelector("[data-js-like-share-button]"),urlParams=new URLSearchParams(window.location.search),sharedPosts=urlParams.get("liked-posts"),likedPostsStructurer=new LikedPostsStructurer,likedPostsApiUrlBuilder=new LikedPostsApiUrlBuilder(wpApiSettings);postTypesToShow&&renderContainer&&noPostsNotice&&preLoaders&&(sharedPosts&&new Shared(renderContainer,urlParams,sharedTitle,sharedExcerpt),new LikeModule(wpApiSettings,likeStorage,sharedPosts,likedPostsStructurer,likedPostsApiUrlBuilder,postTypesToShow,postAppearance,renderContainer,noPostsNotice,preLoaders)),shareButton&&shareUrlField&&shareListField&&shareExcerptField&&new Share(likeStorage,postTypesToShow,postAppearance,likedPostsStructurer,likedPostsApiUrlBuilder,shareButton,shareUrlField,shareListField,shareExcerptField)})});
//# sourceMappingURL=like-posts.fuM1fY8m.js.map
