(()=>{"use strict";const e=new class{constructor(){this.handleLike()}handleLike(){const e=document.querySelectorAll("[data-like-icon]");this.amountOfLikedPosts(this.getLocalStorage()),this.setLiked(this.getLocalStorage()),e&&this.setListeners(e)}setListeners(e){e.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const s=e.getAttribute("data-post-id"),o=e.getAttribute("data-post-type");this.setLocalStorage(s,o)}))}))}getLocalStorage(){return JSON.parse(localStorage.getItem("liked-posts"))||[]}setLocalStorage(e,t){let s=this.getLocalStorage();const o=s.findIndex((s=>s.id===e&&s.type===t));-1===o?s.push({id:e,type:t}):s.splice(o,1),localStorage.setItem("liked-posts",JSON.stringify(s)),this.toggleLiked(e),this.amountOfLikedPosts(s)}toggleLiked(e){const t=document.querySelectorAll(`[data-post-id="${e}"]`);t&&t.forEach((e=>{e.classList.toggle("is-liked"),this.changeIcon(e)}))}setLiked(e){e.forEach((e=>{const t=document.querySelectorAll(`[data-post-id="${e.id}"]`);t&&t.forEach((e=>{e.classList.add("is-liked"),this.changeIcon(e)}))}))}changeIcon(e){e.classList.contains("is-liked")?e.querySelector("span").innerHTML=e.querySelector("span").innerHTML.replace("_outline",""):e.querySelector("span").innerHTML=e.querySelector("span").innerHTML+"_outline"}amountOfLikedPosts(e){const t=document.querySelector("#liked-posts-amount");t&&e&&(t.innerHTML=e.length)}};new class{constructor(e){this.getPosts(),this.posts=null,this.renderInstance=e}getPosts(){if(!document.querySelector("[js-like-container]"))return;if(this.posts)return this.renderPosts();let e=this.handleEndpoints()??"";const t=this.getContainersPostTypes();let s=[];if(e)for(const o in e)e.hasOwnProperty(o)&&t.includes(o)&&s.push(this.getUrls(o,e[o]));s.length>0&&this.fetchPosts(s)}fetchPosts(e){const t=e.map((e=>fetch(e)));Promise.all(t).then((e=>{const t=e.map((e=>e.json()));return Promise.all(t)})).then((e=>{const t=[].concat(...e);this.posts=t,this.renderPosts()})).catch((e=>{console.log(e)}))}getUrls(e,t){let s="";return t.forEach(((e,o)=>{s+=e.id,o<t.length-1&&(s+=",")})),`https://localhost/wptest/wp-json/wp/v2/${"post"===e?"posts":e}?_embed&include=${s}`}getContainersPostTypes(){const e=document.querySelectorAll("[js-like-container]");let t=[];return e.forEach((e=>{e.hasAttribute("js-post-types")&&JSON.parse(e.getAttribute("js-post-types")).forEach((e=>{t.includes(e)||t.push(e)}))})),t}handleEndpoints(){return this.getLocalStorage().reduce(((e,t)=>(e[t.type]?e[t.type].push(t):e[t.type]=[t],e)),{})}getLocalStorage(){return JSON.parse(localStorage.getItem("liked-posts"))||[]}renderPosts(){const e=this.posts.map((e=>{if(e._embedded?.["wp:featuredmedia"]?.[0].media_details){const t=e._embedded["wp:featuredmedia"][0].media_details.sizes.medium;return{...e,image:t}}return e}));this.renderInstance.renderComponents(e)}}(new class{constructor(e,t){this.components=e,this.likeInstance=t}renderComponents(e){const t=document.querySelectorAll("[js-like-container]");e&&e.length>0&&t&&t.forEach((t=>{const s=t.getAttribute("js-display-as"),o=this.filterPosts(e,JSON.parse(t.getAttribute("js-post-types")));let n=[];o&&o.forEach((e=>{const o=document.createElement("div"),r=this.components[`${s}`].html.replace("{LIKE_POST_TITLE}",e.title.rendered).replace("{LIKE_POST_CONTENT}",e.excerpt.rendered).replace("{LIKE_POST_ID}",e.id).replace("{LIKE_POST_LINK}",e.link).replace("{LIKE_POST_IMAGE}",e.image?e.image.source_url:"").replace("{LIKE_POST_TYPE}",e.type);o.innerHTML=r,t.appendChild(o),n.push(o.querySelector("[data-like-icon]")),o.classList.add("u-position--relative")})),this.likeInstance.setListeners(n)}))}filterPosts(e,t){return e.filter((e=>t.includes(e.type)))}}(likedPostsComponents,e))})();
//# sourceMappingURL=like-posts.66a90b500c13be9a9d06.js.map