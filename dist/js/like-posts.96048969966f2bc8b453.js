(()=>{"use strict";var t={91(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,s,i,o,r,a,n,l,d){if(this.wpApiSettings=t,this.likeStorage=e,this.sharedPosts=s,this.likedPostsStructurer=i,this.likedPostsApiUrlBuilder=o,this.postTypesToShow=r,this.postAppearance=a,this.renderContainer=n,this.noPostsNotice=l,this.preLoaders=d,this.displayNoneClass="u-display--none",this.likedPosts=this.likeStorage.get(),this.sharedPosts){const t=atob(this.sharedPosts),e=JSON.parse(t);"string"==typeof e&&e.length>0?this.fetchPosts(e):(console.error("Invalid shared posts data:",this.sharedPosts),this.noPostsFound())}else this.handleLikedPosts()}handleLikedPosts(){if(Object.keys(this.likedPosts).length<=0)return void this.noPostsFound();const t=this.likedPostsApiUrlBuilder.build(this.likedPosts,this.postAppearance,this.postTypesToShow);this.fetchPosts(t)}fetchPosts(t){var e,s;fetch(t,{credentials:"include",headers:{"Content-Type":"application/json","X-WP-NONCE":null!==(s=null===(e=this.wpApiSettings)||void 0===e?void 0:e.nonce)&&void 0!==s?s:""}}).then(t=>{if(!t.ok)throw new Error("Failed to fetch post");return t.json()}).then(t=>{this.handleFetched(t)}).catch(t=>{console.error("Fetch error:",t),this.noPostsFound()})}handleFetched(t){t&&"string"==typeof t?(this.removePreloaders(),this.renderContainer.innerHTML=t):this.noPostsFound()}removePreloaders(){this.preLoaders.forEach(t=>{t.remove()})}noPostsFound(){this.noPostsNotice.classList.remove(this.displayNoneClass),this.removePreloaders()}}},191(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.initializeLikeButtons=function(t,e,i,o){const a=s=>{const a=s.getAttribute("data-post-id"),n=s.getAttribute("data-post-type"),l=s.getAttribute("data-blog-id");if(!a||!n||!l)return void console.warn("Like button is missing required blogId for likeable post",s);const d=s.closest("[data-js-like-icon-wrapper]");e.addInstance(`${l}-${a}`,new r(t,e,s,d,a,n,i,o,l))};document.querySelectorAll(s).forEach(t=>{a(t)}),new MutationObserver(t=>{t.forEach(t=>{"childList"===t.type&&t.addedNodes.length>0&&[...t.addedNodes].forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=t;e.matches(s)&&a(e),e.querySelectorAll(s).forEach(t=>{a(t)})}})})}).observe(document.body,{childList:!0,subtree:!0})};const s="[data-like-icon]",i="material-symbols--filled",o="data-tooltip";class r{constructor(t,e,s,i,o,r,a,n,l){this.likeStorage=t,this.likeInstancesStorage=e,this.button=s,this.wrapper=i,this.postId=o,this.postType=r,this.tooltipLike=a,this.tooltipUnlike=n,this.blogId=l,this.key=`${this.blogId}-${this.postId}`,this.hasTooltip=Boolean(this.wrapper&&(!!this.tooltipLike||!!this.tooltipUnlike)),this.updateLikedStatus(),this.setTooltip(),this.setListener()}setListener(){this.button.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.likeStorage.set(this.postId,this.postType,this.blogId),this.toggleLiked(),window.dispatchEvent(this.likedPostsUpdatedEvent())})}setTooltip(){this.hasTooltip&&(this.likeStorage.get()[this.key]?this.tooltipUnlike?this.wrapper.setAttribute(o,this.tooltipUnlike):this.wrapper.removeAttribute(o):this.tooltipLike?this.wrapper.setAttribute(o,this.tooltipLike):this.wrapper.removeAttribute(o))}toggleLiked(){this.likeInstancesStorage.getInstances(this.key).forEach(t=>{t.updateLikedStatus(),t.setTooltip()})}updateLikedStatus(){this.likeStorage.get()[this.key]?this.button.classList.add(i):this.button.classList.remove(i)}likedPostsUpdatedEvent(){return new CustomEvent("likedPostsLengthUpdated",{})}}e.default=r},225(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,s,i,o,r,a,n,l){this.likeStorage=t,this.postTypesToShow=e,this.postAppearance=s,this.likedPostsStructurer=i,this.likedPostsApiUrlBuilder=o,this.shareButton=r,this.urlField=a,this.nameField=n,this.excerptField=l,this.sharedParamKey="liked-posts",this.displayNoneClass="u-display--none",new URLSearchParams(window.location.search).get(this.sharedParamKey)||this.renderShareLink()}renderShareLink(){const t=window.location.href.split("?")[0],e=this.generateEncodedLikedPostsParam();if(!e)return;const s=`${t}${e}`;this.urlField.value=s,this.nameField.addEventListener("input",this.updateShareLink.bind(this,this.urlField,this.nameField,this.excerptField)),this.excerptField.addEventListener("input",this.updateShareLink.bind(this,this.urlField,this.nameField,this.excerptField)),this.shareButton.classList.remove(this.displayNoneClass)}generateEncodedLikedPostsParam(){const t=this.likeStorage.get();if(0==Object.keys(t).length)return!1;const e=this.likedPostsApiUrlBuilder.build(t,this.postAppearance,this.postTypesToShow);return"?liked-posts="+btoa(JSON.stringify(e))}updateShareLink(t,e,s){const i=btoa(e.value),o=btoa(s.value),r=new URL(t.value);r&&(r.searchParams.set("liked-name",i),r.searchParams.set("liked-excerpt",o),i||r.searchParams.delete("liked-name"),o||r.searchParams.delete("liked-excerpt")),t.value=r.href}}},240(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.instances={}}getInstances(t){return this.instances[t]||[]}addInstance(t,e){this.instances[t]||(this.instances[t]=[]),this.instances[t].push(e)}}},271(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.initializeLikedCounter=function(t){const e=document.querySelectorAll("[data-js-like-icon-counter]");if(0===e.length)return;const i=new s(t,[...e]);window.addEventListener("likedPostsLengthUpdated",t=>{i.updateCounter()})};class s{constructor(t,e){this.likeStorage=t,this.counterElements=this.addCounterToIcon(e),this.updateCounter()}addCounterToIcon(t){return t.map(t=>(t.innerHTML+=this.getLikeIconMarkup(),t.querySelector("[data-js-like-counter]")))}updateCounter(){const t=Object.keys(this.likeStorage.get()).length;this.counterElements.forEach(e=>{e&&(e.innerHTML=t.toString()),0===t?null==e||e.classList.add("u-display--none"):null==e||e.classList.remove("u-display--none")})}getLikeIconMarkup(){return'<span class="u-display--none like-counter" data-js-like-counter></span>'}}e.default=s},454(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e){this.wpApiSettings=t,this.currentBlogId=e,this.localeStorageKey="liked-posts-v2",this.likedPosts=this.sanitizeLikedPosts(JSON.parse(localStorage.getItem(this.localeStorageKey)||"{}"))}get(){return this.likedPosts}set(t,e,s){let i=this.get();const o=`${s}-${t}`;i[o]?delete i[o]:i[o]={postType:e,blogId:s,postId:t,likedAt:Date.now(),website:this.wpApiSettings.root},localStorage.setItem(this.localeStorageKey,JSON.stringify(i)),this.likedPosts=i}sanitizeLikedPosts(t){const e={};for(const s in t)"string"==typeof t[s]?e[`${this.currentBlogId}-${s}`]={postType:t[s],blogId:this.currentBlogId,postId:s,likedAt:Date.now(),website:this.wpApiSettings.root}:e[s]=t[s];return e}}},525(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,s,i){this.renderContainer=t,this.urlParams=e,this.title=s,this.excerpt=i,this.displayNoneClass="u-display--none",this.nameParamKey="liked-name",this.excerptParamKey="liked-excerpt",this.addSharedData()}addSharedData(){let t=this.urlParams.get(this.nameParamKey),e=this.urlParams.get(this.excerptParamKey);this.title&&t&&this.setSharedValue(this.title,t),this.excerpt&&e&&this.setSharedValue(this.excerpt,e)}setSharedValue(t,e){t.textContent=this.sanitizeUrlParams(e),t.classList.remove(this.displayNoneClass)}sanitizeUrlParams(t){let e=atob(t);return e=e.replace(/(<([^>]+)>)/gi,""),e}}},567(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{structure(t){const e={};for(const s in t)e[t[s].website]||(e[t[s].website]=[]),e[t[s].website].push(t[s]);return e}}},616(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,s){this.wpApiSettings=t,this.userId=e,this.likedPosts={},this.userEndpoint="",this.userEndpoint=`${this.wpApiSettings.root}wp/v2/users/${this.userId}`,this.likedPosts=this.sanitizeLikedPostsMeta(s)}get(){return this.likedPosts}set(t,e,s){var i;const o=`${s}-${t}`,r=this.get();r[o]?delete r[o]:r[o]={postType:e,blogId:s,postId:t,likedAt:Date.now(),website:this.wpApiSettings.root},fetch(this.userEndpoint,{method:"PATCH",headers:{"Content-Type":"application/json","X-WP-NONCE":null!==(i=null===wpApiSettings||void 0===wpApiSettings?void 0:wpApiSettings.nonce)&&void 0!==i?i:""},body:JSON.stringify({meta:{likedPosts:r}})}).then(t=>{if(!t.ok)throw new Error("Failed to update user data");return t.json()}).catch(t=>{console.error("Error:",t)})}sanitizeLikedPostsMeta(t){return t&&"object"==typeof t?Object.fromEntries(Object.entries(t).filter(([t,e])=>e&&"object"==typeof e&&"postId"in e&&"blogId"in e&&"postType"in e&&"likedAt"in e)):{}}}},748(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.wpApiSettings=t}build(t,e,s){let i=[];for(const e in t)s&&!s.includes(t[e].postType)||i.push(e);return`${this.wpApiSettings.root}like/v1/ids=${i.join(",")}?html&appearance=${e}&cache-bust=${Date.now()}`}}},849(t,e,s){var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=s(271),r=i(s(525)),a=i(s(225)),n=i(s(91)),l=i(s(616)),d=i(s(454)),h=s(191),p=i(s(240)),c=i(s(567)),u=i(s(748));document.addEventListener("DOMContentLoaded",()=>{const t=wpApiSettings,e=likedPosts&&likedPosts.currentUser&&"0"!==likedPosts.currentUser&&likedPosts.likedPostsMeta&&t?new l.default(t,likedPosts.currentUser,likedPosts.likedPostsMeta):new d.default(t,likedPosts.currentBlogId),s=likedPosts.tooltipLike,i=likedPosts.tooltipUnlike;(0,o.initializeLikedCounter)(e),(0,h.initializeLikeButtons)(e,new p.default,s,i),document.querySelectorAll("[data-js-like-posts]").forEach(t=>{const s=JSON.parse(t.getAttribute("data-js-like-posts-post-types")||"[]"),i=t.getAttribute("data-js-like-posts-appearance")||"collection",o=t.querySelector("[data-js-render-container]"),l=t.querySelector("[data-js-no-posts-notice]"),d=t.querySelectorAll("[data-js-like-preloader]"),h=t.querySelector("[data-js-liked-posts-share-title]"),p=t.querySelector("[data-js-liked-posts-share-excerpt]"),k=t.querySelector("[data-js-like-share-url]"),g=t.querySelector("[data-js-like-share-name]"),P=t.querySelector("[data-js-like-share-excerpt]"),y=t.querySelector("[data-js-like-share-button]"),f=new URLSearchParams(window.location.search),S=f.get("liked-posts"),w=new c.default,b=new u.default(wpApiSettings);s&&o&&l&&d&&(S&&new r.default(o,f,h,p),new n.default(wpApiSettings,e,S,w,b,s,i,o,l,d)),y&&k&&g&&P&&new a.default(e,s,i,w,b,y,k,g,P)})})}},e={};!function s(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,s),r.exports}(849)})();
//# sourceMappingURL=like-posts.96048969966f2bc8b453.js.map